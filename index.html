<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Multi-Channel Inquiry Dashboard</title>

<style>
body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
.card { border:1px solid #ddd; border-radius:14px; padding:16px; margin-bottom:16px; }
button { padding:10px 14px; border-radius:10px; border:1px solid #333; cursor:pointer; }
.row { display:flex; gap:10px; flex-wrap:wrap; }
.muted { color:#555; font-size:13px; }
</style>
</head>

<body>

<h2>Inquiry System</h2>

<div class="row">
  <a href="?mode=form" class="muted">Form</a>
  <a href="?mode=admin" class="muted">Admin</a>
</div>

<div id="form" class="card" style="display:none;">
  <h3>Inquiry Form</h3>
  <input id="name" placeholder="Name" style="width:100%;margin-bottom:8px;">
  <input id="contact" placeholder="Phone / Email" style="width:100%;margin-bottom:8px;">
  <textarea id="message" placeholder="Message" style="width:100%;height:120px;"></textarea>
  <button id="send">Send</button>
  <div id="status" class="muted"></div>
</div>

<div id="admin" class="card" style="display:none;">
  <h3>Admin Dashboard</h3>
  <div id="list"></div>
</div>

<script>
const STORAGE = "multi_channel_inquiries";
const qs = new URLSearchParams(location.search);
const mode = qs.get("mode") || "form";
const source = qs.get("source") || "facebook";

// ðŸ”— Channel targets
const CHANNELS = {
  facebook: () => "https://business.facebook.com/latest/inbox",
  whatsapp: contact => {
    const d = (contact || "").replace(/\D/g,"");
    if (!d) return null;
    const intl = d.startsWith("0") ? "63" + d.slice(1) : d;
    return `https://wa.me/${intl}`;
  },
  viber: contact => {
    const d = (contact || "").replace(/\D/g,"");
    return d ? `viber://chat?number=%2B${d}` : null;
  }
};

function load() {
  return JSON.parse(localStorage.getItem(STORAGE) || "[]");
}
function save(d) {
  localStorage.setItem(STORAGE, JSON.stringify(d));
}

function buildCopyText(item) {
  return (
    `New inquiry (${item.source})\n` +
    `Name: ${item.name}\n` +
    `Contact: ${item.contact}\n` +
    `Message:\n${item.message}\n\n` +
    `Reply:\n`
  );
}

// ---------- FORM ----------
if (mode === "form") {
  document.getElementById("form").style.display = "block";
  document.getElementById("send").onclick = () => {
    const name = name.value || "(no name)";
    const contact = contact.value || "";
    const message = message.value;
    if (!message) return;

    const data = load();
    data.unshift({
      id: Date.now(),
      name, contact, message,
      source,
      time: new Date().toISOString()
    });
    save(data);
    status.textContent = "Inquiry sent.";
    message.value = "";
  };
}

// ---------- ADMIN ----------
if (mode === "admin") {
  document.getElementById("admin").style.display = "block";
  const list = document.getElementById("list");
  const data = load();

  if (!data.length) list.innerHTML = "<div class='muted'>No inquiries</div>";

  data.forEach(item => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <strong>${item.name}</strong>
      <div class="muted">${item.source}</div>
      <p>${item.message}</p>
      <div class="row">
        <button>Copy + Open ${item.source}</button>
      </div>
    `;

    div.querySelector("button").onclick = async () => {
      const text = buildCopyText(item);
      await navigator.clipboard.writeText(text);

      const opener = CHANNELS[item.source];
      if (opener) {
        const url = opener(item.contact);
        if (url) window.open(url, "_blank");
      }
    };

    list.appendChild(div);
  });
}
</script>

</body>
</html>
